DEF Init
-- Inicialização Carrega constantes e limpa memória
-- Limpa HEX
LDI RY 0
STA RY HEX0
STA RY HEX1
STA RY HEX2
STA RY HEX3
STA RY HEX4
STA RY HEX5
-- Limpa LEDs
STA RY LED0TO7
STA RY LED8
STA RY LED9
-- MEM[50] = 0
LDI RY 0
STA RY 50
-- MEM[51] = 1
LDI RY 1
STA RY 51
-- MEM[52] = 2
LDI RY 2
STA RY 52
-- MEM[53] = 6
LDI RY 6
STA RY 53
-- MEM[54] = 10
LDI RY 10
STA RY 54
-- Limites para cada contador
LDI RY 0
STA RY 6
STA RY 7
STA RY 8
STA RY 9
STA RY 10
STA RY 11
-- Contadores de quantidades (um pra cada HEX)
LDI RY 0
STA RY 0
STA RY 1
STA RY 2
STA RY 3
STA RY 4
STA RY 5
-- Flags
LDI RY 0
-- Flag _stop_
STA RY 12 
RET

DEF INCREMENT
LDI RY 1
STA RY CLR
-- Verifica flag _stop_
LDI RY 0
CEQ RY 12
JEQ +45
-- Soma 1, depois compara
LDI RX 1
ADD RX 0
LDA RD 54
CEQ RD 0
JEQ +2
JMP +38
-- Bateu no limite das unidades
STA RY 0
ADD RX 1
LDA RD 54
CEQ RD 1
JEQ +2
JMP +31
-- Bateu no limite das dezenas
STA RY 1
ADD RX 2
LDA RD 54
CEQ RD 2
JEQ +2
JMP +24
-- Bateu no limite das centenas
STA RY 2
ADD RX 3
LDA RD 54
CEQ RD 3
JEQ +2
JMP +17
-- Bateu no limite dos milhares
STA RY 3
ADD RX 4
LDA RD 540
CEQ RD 4
JEQ +2
JMP +10
-- Bateu no limite das dezenas de milhares
STA RY 4
ADD RX 5
LDA RD 541
CEQ RD 5
JEQ +2
JMP +3
-- Bateu no limite das centenas de milhares
STA RX 12
STA RX LED8
RET

DEF UPDATE_DISPLAY
LDA RY 0
STA RY HEX0
LDA RY 1
STA RY HEX1
LDA RY 2
STA RY HEX2
LDA RY 3
STA RY HEX3
LDA RY 4
STA RY HEX4
LDA RY 5
STA RY HEX5
RET

DEF CONFIG_LIM
-- unidades
LDA RY SW7TO0
STA RY 6
-- dezenas
LDA RX KEY1
CEQ RX 50
JEQ -2
LDA RY SW7TO0
STA RY 7
-- centenas
LDA RX KEY1
CEQ RX 50
JEQ -2
LDA RY SW7TO0
STA RY 8
-- milhares
LDA RX KEY1
CEQ RX 50
JEQ -2
LDA RY SW7TO0
STA RY 9
-- dezenas de milhares
LDA RX KEY1
CEQ RX 50
JEQ -2
LDA RY SW7TO0
STA RY 10
-- centenas de milhares
LDA RX KEY1
CEQ RX 50
JEQ -2
LDA RY SW7TO0
STA RY 11
RET

DEF CHECK_LIM
-- Compara unidades
LDA RD 6
CEQ RD 0
JEQ +2
JMP +24
-- Compara dezenas
LDA RD 7
CEQ RD 1
JEQ +2
JMP +20
-- Compara centenas
LDA RD 8
CEQ RD 2
JEQ +2
JMP +16
-- Compara milhares
LDA RD 9
CEQ RD 3
JEQ +2
JMP +12
-- Compara dezenas de milhares
LDA RD 10
CEQ RD 4
JEQ +2
JMP +8
-- Compara centenas de milhares
LDA RD 11
CEQ RD 5
JEQ +2
JMP +4
-- Tudo igual
LDI RX 1
STA RX 12
STA RX LED9
RET

DEF RESET_COUNT
LDI RY 0
STA RY 12
STA RY LED8
STA RY LED9
RET

-- Inicializa
JSR Init
-- Loop Principal
-- Le Key0 e vai para rotina de incremento, caso necessario
LDA RA KEY0
CEQ RA 50
JEQ +2
JSR INCREMENT
-- Atualiza displays
JSR UPDATE_DISPLAY
-- Le Key1 e vai para rotina de configuracao caso necessario
LDA RB KEY1
CEQ RB 50
JEQ +2
JSR CONFIG_LIM
-- Verifica se a contagem atingiu limite
JSR CHECK_LIM
-- Le FPGA_RESET e reinicia contagem caso necessario
LDA RA RST
CEQ RA 50
JEQ +2
JSR RESET_COUNT
-- Colta para começo
JMP -14